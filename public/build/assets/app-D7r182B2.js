function e(e){const t=document.getElementById("cart-count-badge")||document.querySelector(".cart-count-badge"),n=void 0!==e?parseInt(e):parseInt(localStorage.getItem("cartCount")||0);t&&(t.textContent=isNaN(n)?"0":String(n),t.classList?n>0?(t.classList.remove("hidden"),t.classList.add("scale-110"),setTimeout(()=>t.classList.remove("scale-110"),300)):t.classList.add("hidden"):t.style.display=n>0?"block":"none")}function t(){const e={},t=document.querySelector("#price_range")?.value;t&&(e.price_range=t);const n=document.querySelector("#category_filter")?.value;n&&(e.category=n);const r=document.querySelector("#sort_by")?.value;r&&(e.sort=r),document.querySelectorAll('input[type="checkbox"]:checked').forEach(t=>{e[t.name]=t.value||!0}),function(e){const t=new URL(window.location);Object.keys(e).forEach(n=>{e[n]?t.searchParams.set(n,e[n]):t.searchParams.delete(n)}),window.history.pushState({},"",t)}(e),function(e){document.querySelectorAll(".product-card").forEach(t=>{let n=!0;if(e.price_range){const r=function(e){const t=e.querySelector(".product-price");if(t)return parseFloat(t.dataset.price||t.textContent.replace(/[^\d.]/g,""));return 0}(t);n=n&&function(e,t){const[n,r]=t.split("-").map(e=>"+"===e?1/0:parseFloat(e));return e>=n&&(r===1/0||e<=r)}(r,e.price_range)}if(e.category){const r=t.dataset.category;n=n&&r===e.category}t.style.display=n?"block":"none"}),function(){const e=document.querySelectorAll('.product-card[style*="block"], .product-card:not([style*="none"])'),t=document.querySelector("#results-count");t&&(t.textContent=e.length)}()}(e)}function n(e,t="info",n=5e3){const r=document.querySelector("#toast-container");if(!r)return;const c=document.createElement("div");c.className=`toast toast-${t} transform translate-x-full transition-transform duration-300`;const o=function(e){switch(e){case"success":return'<i class="fas fa-check-circle"></i>';case"error":return'<i class="fas fa-exclamation-circle"></i>';case"warning":return'<i class="fas fa-exclamation-triangle"></i>';default:return'<i class="fas fa-info-circle"></i>'}}(t),a=function(e){switch(e){case"success":return"bg-green-500";case"error":return"bg-red-500";case"warning":return"bg-yellow-500";default:return"bg-blue-500"}}(t);c.innerHTML=`\n        <div class="flex items-center p-4 ${a} text-white rounded-lg shadow-lg">\n            <div class="flex-shrink-0">\n                ${o}\n            </div>\n            <div class="ml-3">\n                <p class="text-sm font-medium">${e}</p>\n            </div>\n            <div class="ml-auto pl-3">\n                <button onclick="this.parentElement.parentElement.parentElement.remove()" class="text-white hover:text-gray-200">\n                    <i class="fas fa-times"></i>\n                </button>\n            </div>\n        </div>\n    `,r.appendChild(c),setTimeout(()=>{c.classList.remove("translate-x-full")},100),setTimeout(()=>{c.classList.add("translate-x-full"),setTimeout(()=>{c.parentElement&&c.remove()},300)},n)}function r(){return document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||document.querySelector('input[name="_token"]')?.value}document.addEventListener("DOMContentLoaded",function(){e(),document.querySelectorAll("[data-cart-update]").forEach(e=>{e.addEventListener("click",function(){!function(e,t){const c=new FormData;c.append("item_id",e),c.append("change",t),c.append("_token",r()),fetch("/cart/update",{method:"POST",body:c}).then(e=>e.json()).then(e=>{e.success?location.reload():n("Error updating cart: "+e.message,"error")}).catch(e=>{n("Error updating cart","error")})}(this.dataset.cartUpdate,parseInt(this.dataset.change)||1)})}),document.querySelectorAll("[data-cart-remove]").forEach(e=>{e.addEventListener("click",function(){!function(e){if(confirm("Are you sure you want to remove this item from your cart?")){const t=new FormData;t.append("item_id",e),t.append("_token",r()),fetch("/cart/remove",{method:"POST",body:t}).then(e=>e.json()).then(e=>{e.success?location.reload():n("Error removing item: "+e.message,"error")}).catch(e=>{n("Error removing item","error")})}}(this.dataset.cartRemove)})}),function(){const e=document.querySelector("#search");if(e){let t;e.addEventListener("input",function(){clearTimeout(t);const e=this.value.trim();e.length>=2?t=setTimeout(()=>{!function(e){const t=document.querySelector("#search-results");if(!t)return;t.innerHTML='<div class="text-center py-8"><div class="spinner"></div><p class="mt-2 text-gray-600">Searching...</p></div>',fetch(`/search?q=${encodeURIComponent(e)}`).then(e=>e.text()).then(e=>{t.innerHTML=e}).catch(e=>{t.innerHTML='<div class="text-center py-8 text-red-600">Error performing search</div>'})}(e)},300):0===e.length&&function(){const e=document.querySelector("#search-results");e&&(e.innerHTML="")}()})}}(),function(){const e=document.querySelector("#price_range");e&&e.addEventListener("change",t);const n=document.querySelector("#category_filter");n&&n.addEventListener("change",t);const r=document.querySelector("#sort_by");r&&r.addEventListener("change",t);document.querySelectorAll('input[type="checkbox"]').forEach(e=>{e.addEventListener("change",t)})}(),function(){const e=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&e.target.classList.add("animate-in")})},{threshold:.1,rootMargin:"0px 0px -50px 0px"});document.querySelectorAll(".animate-on-scroll").forEach(t=>{e.observe(t)}),document.querySelectorAll(".hover-lift").forEach(e=>{e.addEventListener("mouseenter",function(){this.style.transform="translateY(-5px)"}),e.addEventListener("mouseleave",function(){this.style.transform="translateY(0)"})})}(),function(){if(!document.querySelector("#toast-container")){const e=document.createElement("div");e.id="toast-container",e.className="fixed top-4 right-4 z-50 space-y-2",document.body.appendChild(e)}}()}),document.addEventListener("DOMContentLoaded",function(){const e=document.querySelectorAll("img[data-src]"),t=new IntersectionObserver((e,n)=>{e.forEach(e=>{if(e.isIntersecting){const n=e.target;n.src=n.dataset.src,n.classList.remove("lazy"),t.unobserve(n)}})});e.forEach(e=>t.observe(e))}),window.BakeryShop={showToast:n,quickAddToCart:function(t,c=1,o=null){const a=new FormData;let s;a.append("product_id",t),a.append("qty",c),a.append("_token",r()),o&&(s=o.innerHTML,o.innerHTML='<i class="fas fa-spinner fa-spin mr-2"></i>Adding...',o.disabled=!0),fetch("/cart/add",{method:"POST",body:a,headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"},credentials:"same-origin"}).then(async t=>{let r={};try{r=await t.json()}catch(a){}if(t.ok&&r.success){o&&(o.innerHTML='<i class="fas fa-check mr-2"></i>Added',o.classList.add("bg-green-500"),setTimeout(()=>{o.innerHTML=s,o.classList.remove("bg-green-500"),o.disabled=!1},1500));try{!function(e){const t=document.getElementById("cart-count-badge")||document.querySelector(".cart-count-badge")||document.querySelector("[data-cart-icon]");if(!e||!t)return;const n=e.getBoundingClientRect(),r=t.getBoundingClientRect(),c=document.createElement("div");c.style.position="fixed",c.style.left=n.left+n.width/2+"px",c.style.top=n.top+n.height/2+"px",c.style.width="10px",c.style.height="10px",c.style.borderRadius="50%",c.style.background="#f97316",c.style.zIndex=9999,c.style.transition="transform 600ms cubic-bezier(0.22, 1, 0.36, 1), opacity 600ms",document.body.appendChild(c);const o=r.left+r.width/2-(n.left+n.width/2),a=r.top+r.height/2-(n.top+n.height/2);requestAnimationFrame(()=>{c.style.transform=`translate(${o}px, ${a}px) scale(0.2)`,c.style.opacity="0.2",setTimeout(()=>{c.parentElement&&c.remove()},650)})}(o)}catch(i){}if(void 0!==r.cart_count)localStorage.setItem("cartCount",parseInt(r.cart_count)),e(r.cart_count);else{const t=parseInt(localStorage.getItem("cartCount")||0);localStorage.setItem("cartCount",t+c),e()}}else{o&&(o.innerHTML='<i class="fas fa-exclamation mr-2"></i>Limit',o.classList.add("bg-red-500"),setTimeout(()=>{o.innerHTML=s,o.classList.remove("bg-red-500"),o.disabled=!1},1500));n(r&&r.message?r.message:"Unable to add product to cart","error")}}).catch(e=>{o&&(o.innerHTML=s,o.disabled=!1),n("Unable to reach server. Please try again.","error")})},addToWishlist:function(e){n("Product added to wishlist!","success")},validateForm:function(e){const t=e.querySelectorAll("input[required], select[required], textarea[required]");let n=!0;return t.forEach(e=>{e.value.trim()?e.classList.remove("border-red-500"):(e.classList.add("border-red-500"),n=!1)}),n},toggleMobileMenu:function(){const e=document.querySelector("#mobile-menu");e&&e.classList.toggle("hidden")},updateCartCount:e};
